<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<script src="main.js"></script>

	<title>Login</title>
</head>
<body>
	
<div class="form">
      
	<ul class="tab-group">
	  <li class="tab active"><a href="#signup">Sign Up</a></li>
	  <li class="tab"><a href="#login">Log In</a></li>
	</ul>
	
	<div class="tab-content">
	  <div id="signup">   
		<h1>Sign Up </h1>
		
		<form id="signup-form" action="/" method="post">
		
		<div class="top-row">
		  <div class="field-wrap">
			<label>
			  First Name<span class="req">*</span>
			</label>
			<input name="first_name" type="text" required autocomplete="off" />
		  </div>
	  
		  <div class="field-wrap">
			<label>
			  Last Name<span class="req">*</span>
			</label>
			<input name="last_name" type="text"required autocomplete="off"/>
		  </div>
		</div>

		<div class="field-wrap">
		  <label>
			Email Address<span class="req">*</span>
		  </label>
		  <input name="email" type="email"required autocomplete="off"/>
		</div>
		
		<div class="field-wrap">
		  <label>
			Set A Password<span class="req">*</span>
		  </label>
		  <input name="password" type="password" required autocomplete="off"/>
		</div>
		<div class="field-wrap">
			<label>
			  City ID<span class="req">*</span>
			</label>
			<input name="city_id" type="text" required autocomplete="off"/>
		  </div>

		<select name="type" id="type">
			<option value="">--Please choose an option--</option>
			<option value="worker">Worker</option>
			<option value="client">Client</option>
		</select>
		<button type="submit" class="button button-block" onclick="Register('signup-form'); return false;" >Get Started</button>
		


        
		</form>

	  </div>

	  <div id="login">   
		<h1>Welcome Back!</h1>
		
		<form id="login-form" action="/" method="POST">
		
		  <div class="field-wrap">
		  <label>
			Email<span class="req">*</span>
		  </label>
		  <input type="text" id="email" name="email" required autocomplete="on"/>
		</div>
		
		<div class="field-wrap">
		  <label>
			Password<span class="req">*</span>
		  </label>
		  <input type="password" id="password" name="password" required autocomplete="off"/>
		</div>
		
		<p class="forgot"><a id="forgotlink" href="#">Forgot Password?</a></p>
        		
		<button class="button button-block" onclick="submitForm('login-form'); return false;">Log In</button>
		
		</form>

	  </div>
	  
	</div><!-- tab-content -->
</div> <!-- /form -->
<div id="forgot-password-modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeForgotPasswordModal()">&times;</span>
        <h1>Forgot Password</h1>
        
        <form id="forgot-password-form" action="/" method="POST">
            <div class="field-wrap" class="forgot-email">
                <label>Email<span class="req">*</span></label>
                <input type="text" id="forgot-email" name="email" required autocomplete="on"/>
            </div>
            
            <button class="button button-block" onclick="forgotPassword('forgot-password-form'); return false;">Reset Password</button>
        </form>
    </div>
</div>


<script src="main.js"></script>
<script>
		function submitForm(formId) {
			var formData = {};
			var form = $('#' + formId);
	
			form.find('input').each(function() {
				formData[$(this).attr('name')] = $(this).val();
			
			});

	
			fetch('http://127.0.0.1:5000/api/v1/login', {
				method: 'POST',
				headers: {'Content-Type': 'application/json',},
				body: JSON.stringify(formData),
			})
			.then(response => {
				// Inspect the headers in the response
				response.headers.forEach(console.log);
				alert(response.headers)
				for(let entry of response.headers.entries()) {
				  console.log(entry);
				}
				//window.location.href = '/home.html'
			  })
			  .catch(err => console.error(err));
		}
		
		function Register(formId) {
			var formData = {};
			var form = $('#' + formId);
	

				form.find('select').each(function() {
					formData[$(this).attr('name')] = $(this).val();
			});
			form.find('input').each(function() {
				formData[$(this).attr('name')] = $(this).val();
		});
		let files = event.target.files
  		let fileName = files[0].name
		data.append('files', files[0]) // maybe it should be '{target}_cand'
		data.append('name', fileName)
		
		var fileInput = form.find('input[type="file"]')[0];
		formData.append('profile_img', fileInput.files[0]);

			event.preventDefault();
			fetch('http://127.0.0.1:5000/api/v1/register', {
				method: 'POST',
				body: formData,
			})
			.then(response => {
				// Inspect the headers in the response
				response.headers.forEach(console.log);
				//alert("in register")
				for(let entry of response.headers.entries()) {
				  console.log(entry);
				}
				//window.location.href = '/home.html'
			  })
			  .catch(err => console.error(err));
		}

        function openForgotPasswordModal() {
            document.getElementById('forgot-password-modal').style.display = 'block';
        }
    
        function closeForgotPasswordModal() {
            document.getElementById('forgot-password-modal').style.display = 'none';
        }
    
        document.querySelector('#forgotlink').addEventListener('click', function() {
            openForgotPasswordModal();
        });
        function forgotPassword(formId) {
            var formData = {};
            var form = $('#' + formId);
            
            form.find('input').each(function() {
                formData[$(this).attr('name')] = $(this).val();
            });
        
            fetch('http://127.0.0.1:5000/api/v1/forgot-password', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(formData),
            })
            .then(response => {
                response.headers.forEach(console.log);
                for (let entry of response.headers.entries()) {
                    console.log(entry);
                }
                
                if (response.ok) {
                    alert("Password reset instructions sent to your email");
                    closeForgotPasswordModal(); 
                } else {
                    alert("Failed to reset password. Please check your email and try again.");
                }
            })
            .catch(err => console.error(err));
        }
		
</script>
</body>
</html>